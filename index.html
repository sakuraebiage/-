<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ˜Ÿå®ˆæˆ¦ç·š - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</title>
  <style>
    body {
      margin: 0;
      font-family: "Consolas", "Roboto Mono", monospace;
      background: #000;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    main {
      padding: 20px;
      width: 90%;
      max-width: 1000px;
    }

    /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰ */
    .character-card {
      background: #111;
      border: 1px solid #555;
      border-radius: 10px;
      padding: 10px;
      width: 200px;
      text-align: center;
      display: inline-block;
      margin: 10px;
      cursor: pointer;
    }
    .character-card img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 2px solid #8ae1ff;
      object-fit: cover;
    }
    .character-card .character-name {
      font-weight: bold;
      color: #8ae1ff;
      margin-top: 6px;
    }
  </style>
</head>

<body>
  <!-- âœ… å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ã‚’èª­ã¿è¾¼ã‚€ -->
 <div id="header-container"></div>
 <script src="/common/header.js"></script>

  <main>
    <h2>ç™»éŒ²ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸€è¦§</h2>
    <div id="character-list"></div>

    <h2>ã‚­ãƒ£ãƒ©ç®¡ç†</h2>
    <div id="newCharForm">
      <input type="text" id="newCharName" placeholder="ã‚­ãƒ£ãƒ©å">
      <button onclick="addNewChar()">è¿½åŠ </button>
    </div>
    <div id="charList"></div>
  </main>

  <script>
    // âœ… å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼èª­ã¿è¾¼ã¿
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-container").innerHTML = html;
      });

    // ======== ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ========
    let userData = JSON.parse(localStorage.getItem("user_chars")) || { chars: [], selectedCharIndex: 0 };

    function renderCharList() {
      const list = document.getElementById("charList");
      list.innerHTML = "";
      userData.chars.forEach((char, i) => {
        const div = document.createElement("div");
        div.style.marginBottom = "8px";
        const selectedMark = userData.selectedCharIndex === i ? "ğŸŒŸ" : "";
        div.innerHTML = `
          ${selectedMark} <strong>${char.name}</strong>
          <img src="${char.icon || 'https://placehold.co/32x32?text=?'}" width="32" height="32">
          <button onclick="selectChar(${i})">åˆ‡æ›¿</button>
        `;
        list.appendChild(div);
      });
    }

    function addNewChar() {
      const name = document.getElementById("newCharName").value.trim();
      if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
      const newChar = { name, icon: "", stats: {}, skills: [], points: 0 };
      userData.chars.push(newChar);
      userData.selectedCharIndex = userData.chars.length - 1;
      localStorage.setItem("user_chars", JSON.stringify(userData));
      renderCharList();
      document.getElementById("newCharName").value = "";
    }

    function selectChar(index) {
      userData.selectedCharIndex = index;
      localStorage.setItem("user_chars", JSON.stringify(userData));
      renderCharList();
    }

    renderCharList();

    // ======== ç™»éŒ²æ¸ˆã‚­ãƒ£ãƒ©ä¸€è¦§è¡¨ç¤º ========
    const characters = userData.chars;
    const list = document.getElementById("character-list");
    if (characters.length === 0) {
      list.innerHTML = "<p>ã¾ã ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>";
    } else {
      characters.forEach(c => {
        const card = document.createElement("div");
        card.classList.add("character-card");

        const img = document.createElement("img");
        img.src = c.icon || "https://placehold.co/120x120?text=No+Icon";

        const name = document.createElement("div");
        name.textContent = c.name;
        name.classList.add("character-name");

        card.appendChild(img);
        card.appendChild(name);

        card.addEventListener("click", () => {
          window.location.href = "mypage.html?char=" + encodeURIComponent(c.name);
        });

        list.appendChild(card);
      });
    }
  </script>
</body>
</html>
