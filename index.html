<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>防衛戦マップ</title>
<style>
body { font-family: sans-serif; margin: 0; padding: 0; }
#map { position: relative; width: 100%; height: 80vh; background: #e0f7fa; }
.base { width: 40px; height: 40px; border-radius: 50%; position: absolute; text-align: center; line-height: 40px; color: #fff; font-weight: bold; cursor: pointer; }
.official { background: #ff5722; }
.user { background: #4caf50; }
.arrow { position: absolute; width: 2px; background: black; transform-origin: top left; }
#announcements { height: 20vh; background: #fafafa; overflow-y: auto; padding: 10px; border-top: 1px solid #ccc; }
.face { width: 20px; height: 20px; border-radius: 50%; display: inline-block; background: #ffeb3b; margin-right: 2px; vertical-align: middle; }
</style>
</head>
<body>
<div id="map"></div>
<div id="announcements"></div>
<script>
const map = document.getElementById('map');
const announcements = document.getElementById('announcements');

// 拠点データ
const bases = [
  { id: 'official1', x: 100, y: 100, type: 'official', name: '学園本部', faces: ['A','B'] },
  { id: 'user1', x: 250, y: 150, type: 'user', name: 'カフェ', faces: ['C'] },
  { id: 'user2', x: 100, y: 250, type: 'user', name: '研究室', faces: ['D','E'] }
];

// マップに配置
bases.forEach(b => {
  const div = document.createElement('div');
  div.className = 'base ' + b.type;
  div.style.left = b.x + 'px';
  div.style.top = b.y + 'px';
  div.innerHTML = b.name[0]; // 先頭文字表示

  // 顔アイコン
  b.faces.forEach(f => {
    const fdiv = document.createElement('span');
    fdiv.className = 'face';
    fdiv.title = f;
    div.appendChild(fdiv);
  });

  // クリックでチャットページへ
  div.onclick = () => {
    const areaName = encodeURIComponent(b.name);
    window.location.href = `chat.html?area=${areaName}`;
  };

  map.appendChild(div);
});

// 線を描く関数
function drawLine(x1, y1, x2, y2){
  const line = document.createElement('div');
  line.className = 'arrow';
  const dx = x2 - x1;
  const dy = y2 - y1;
  const length = Math.sqrt(dx*dx + dy*dy);
  line.style.width = length + 'px';
  line.style.left = x1 + 'px';
  line.style.top = y1 + 'px';
  const angle = Math.atan2(dy, dx) * 180 / Math.PI;
  line.style.transform = `rotate(${angle}deg)`;
  map.appendChild(line);
}

// 線を描く（公式→ユーザー拠点）
drawLine(100+20,100+20,250+20,150+20);
drawLine(100+20,100+20,100+20,250+20);

// 簡易アナウンス
const logs = [
  '学園本部防衛完了！',
  'カフェに増援到着',
  '研究室撤退まであと2日'
];
logs.forEach(l => {
  const p = document.createElement('p');
  p.textContent = l;
  announcements.appendChild(p);
});
</script>
</body>
</html>
