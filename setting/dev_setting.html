<!-- 裏メニュー: 開発者ステータス編集 -->
<div id="devPanel" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);color:#e0e0e0;z-index:2000;overflow:auto;padding:20px;">
  <h2 style="color:#8ae1ff;">⚙️ 開発者ステータス編集</h2>
  
  <div style="margin-bottom:15px;">
    <label>キャラ選択:
      <select id="devCharSelect"></select>
    </label>
    <button id="devAddChar">新規追加</button>
    <button id="devDeleteChar">削除</button>
  </div>

  <div id="devForm" style="display:flex;flex-wrap:wrap;gap:15px;">
    <div>
      <label>名前:<br><input type="text" id="devName"></label>
    </div>
    <div>
      <label>HP:<br><input type="number" id="devHP" min="0"></label>
    </div>
    <div>
      <label>MP:<br><input type="number" id="devMP" min="0"></label>
    </div>
    <div>
      <label>攻撃:<br><input type="number" id="devATK" min="0"></label>
    </div>
    <div>
      <label>防御:<br><input type="number" id="devDEF" min="0"></label>
    </div>
    <div>
      <label>魔攻:<br><input type="number" id="devMAG" min="0"></label>
    </div>
    <div>
      <label>魔防:<br><input type="number" id="devMDEF" min="0"></label>
    </div>
    <div>
      <label>素早さ:<br><input type="number" id="devSPD" min="0"></label>
    </div>
    <div>
      <label>幸運:<br><input type="number" id="devLUK" min="0"></label>
    </div>
    <div>
      <label>属性:<br>
        <select id="devElement">
          <option value="炎">炎</option>
          <option value="水">水</option>
          <option value="風">風</option>
          <option value="地">地</option>
          <option value="氷">氷</option>
          <option value="雷">雷</option>
          <option value="光">光</option>
          <option value="闇">闇</option>
          <option value="天">天</option>
        </select>
      </label>
    </div>
    <div style="flex-basis:100%;">
      <label>備考:<br><textarea id="devNotes" rows="3" style="width:100%;"></textarea></label>
    </div>
  </div>

  <div style="margin-top:15px;">
    <button id="devSave">保存</button>
    <button id="devReset">リセット</button>
    <button id="devExport">JSON出力</button>
    <button id="devImport">JSON読み込み</button>
    <button id="devClose">閉じる</button>
  </div>
</div>

<script>
const devPanel = document.getElementById("devPanel");
const devCharSelect = document.getElementById("devCharSelect");
const devName = document.getElementById("devName");
const devHP = document.getElementById("devHP");
const devMP = document.getElementById("devMP");
const devATK = document.getElementById("devATK");
const devDEF = document.getElementById("devDEF");
const devMAG = document.getElementById("devMAG");
const devMDEF = document.getElementById("devMDEF");
const devSPD = document.getElementById("devSPD");
const devLUK = document.getElementById("devLUK");
const devElement = document.getElementById("devElement");
const devNotes = document.getElementById("devNotes");

let devData = JSON.parse(localStorage.getItem("devChars")) || [];

// 開発者画面ショートカット
document.addEventListener("keydown", (e)=>{
  if(e.shiftKey && e.altKey && e.key.toLowerCase()==="d"){
    devPanel.style.display = devPanel.style.display==="none"?"flex":"none";
    populateCharSelect();
  }
});

// キャラ選択反映
function populateCharSelect(){
  devCharSelect.innerHTML="";
  devData.forEach((c,i)=>{
    const opt=document.createElement("option");
    opt.value=i;
    opt.textContent=c.name;
    devCharSelect.appendChild(opt);
  });
  if(devData.length>0){
    devCharSelect.selectedIndex=0;
    loadChar(devCharSelect.value);
  }
}

function loadChar(index){
  const c = devData[index];
  if(!c) return;
  devName.value=c.name;
  devHP.value=c.hp;
  devMP.value=c.mp;
  devATK.value=c.atk;
  devDEF.value=c.def;
  devMAG.value=c.mag;
  devMDEF.value=c.mdef;
  devSPD.value=c.spd;
  devLUK.value=c.luk;
  devElement.value=c.element;
  devNotes.value=c.notes;
}

devCharSelect.addEventListener("change", ()=>loadChar(devCharSelect.value));

document.getElementById("devSave").addEventListener("click", ()=>{
  const idx=devCharSelect.value;
  devData[idx]={
    name:devName.value,
    hp:+devHP.value,
    mp:+devMP.value,
    atk:+devATK.value,
    def:+devDEF.value,
    mag:+devMAG.value,
    mdef:+devMDEF.value,
    spd:+devSPD.value,
    luk:+devLUK.value,
    element:devElement.value,
    notes:devNotes.value
  };
  localStorage.setItem("devChars", JSON.stringify(devData));
  populateCharSelect();
  alert("保存しました！");
});

document.getElementById("devAddChar").addEventListener("click", ()=>{
  const newChar={name:"新規キャラ",hp:100,mp:50,atk:50,def:50,mag:50,mdef:50,spd:50,luk:10,element:"炎",notes:""};
  devData.push(newChar);
  localStorage.setItem("devChars", JSON.stringify(devData));
  populateCharSelect();
});

document.getElementById("devDeleteChar").addEventListener("click", ()=>{
  const idx=devCharSelect.value;
  if(confirm(`本当に ${devData[idx].name} を削除しますか？`)){
    devData.splice(idx,1);
    localStorage.setItem("devChars", JSON.stringify(devData));
    populateCharSelect();
  }
});

document.getElementById("devReset").addEventListener("click", ()=>{
  loadChar(devCharSelect.value);
});

document.getElementById("devClose").addEventListener("click", ()=>{
  devPanel.style.display="none";
});

document.getElementById("devExport").addEventListener("click", ()=>{
  const json=JSON.stringify(devData,null,2);
  prompt("コピーして保存してください", json);
});

document.getElementById("devImport").addEventListener("click", ()=>{
  const json=prompt("JSONを貼り付けてください");
  try{
    const data=JSON.parse(json);
    if(Array.isArray(data)){
      devData=data;
      localStorage.setItem("devChars", JSON.stringify(devData));
      populateCharSelect();
    } else { alert("不正な形式です"); }
  } catch(e){ alert("読み込みエラー"); }
});
</script>
