<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>RPチャット</title>
<style>
body { font-family: sans-serif; margin: 0; padding: 0; display: flex; height: 100vh; }
#areas { width: 30%; background: #eceff1; padding: 10px; overflow-y: auto; }
#chat { width: 70%; display: flex; flex-direction: column; }
#messages { flex: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid #ccc; }
#input { display: flex; }
#input input { flex: 1; padding: 5px; }
#input button { padding: 5px; }
.area { padding: 5px; background: #b0bec5; margin-bottom: 5px; cursor: pointer; }
.area.active { background: #90a4ae; font-weight: bold; }
.face { width: 20px; height: 20px; border-radius: 50%; display: inline-block; background: #ffeb3b; margin-right: 5px; vertical-align: middle; }
button#back { margin-bottom: 10px; padding: 5px; }
</style>
</head>
<body>
<div id="areas">
  <button id="back" onclick="goBack()">防衛画面に戻る</button>
  <h3>エリア一覧</h3>
  <div id="areaList"></div>
  <input id="newArea" placeholder="新しいエリア名">
  <button onclick="addArea()">追加</button>
</div>
<div id="chat">
  <div id="messages"></div>
  <div id="input">
    <input id="msgInput" placeholder="メッセージ入力">
    <button onclick="sendMessage()">送信</button>
  </div>
</div>

<script>
// 初期エリア
let areas = [];
for(let i=0;i<20;i++){
  areas.push({name:'拠点'+(i+1), messages: []});
}

let currentArea = 0;

// URLからエリア指定
const params = new URLSearchParams(window.location.search);
const areaParam = params.get('area');
if(areaParam){
  const idx = areas.findIndex(a => a.name === areaParam);
  if(idx>=0) currentArea = idx;
}

function renderAreas(){
  const list = document.getElementById('areaList');
  list.innerHTML = '';
  areas.forEach((a,i)=>{
    const div = document.createElement('div');
    div.className = 'area'+(i===currentArea?' active':'');
    div.textContent = a.name;
    div.onclick = ()=>{
      currentArea=i;
      renderAreas();
      renderMessages();
    };
    list.appendChild(div);
  });
}

function renderMessages(){
  const msgDiv = document.getElementById('messages');
  msgDiv.innerHTML = '';
  areas[currentArea].messages.forEach(m=>{
    const p = document.createElement('p');
    p.innerHTML = `<span class="face"></span><b>${m.user}:</b> ${m.text}`;
    msgDiv.appendChild(p);
  });
}

function addArea(){
  const name = document.getElementById('newArea').value;
  if(name){
    areas.push({name:name, messages:[]});
    document.getElementById('newArea').value='';
    renderAreas();
  }
}

function sendMessage(){
  const text = document.getElementById('msgInput').value;
  if(text){
    areas[currentArea].messages.push({user:'自分', text:text});
    renderMessages();
    document.getElementById('msgInput').value='';
  }
}

function goBack(){
  window.location.href = 'index.html';
}

// 初期表示
renderAreas();
renderMessages();
</script>
</body>
</html>
