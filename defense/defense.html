<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é˜²è¡›æˆ¦æ³ - æ‹ ç‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</title>
<style>
  body { margin:0; font-family:"Consolas","Roboto Mono",monospace; background:#111; color:#eee; display:flex; flex-direction:column; }
  header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#222; }
  header h1 { color:#8ae1ff; font-size:1.2em; }
  nav a { color:#8ae1ff; margin-left:12px; text-decoration:none; transition:.3s; }
  nav a:hover { color:#fff; text-shadow:0 0 5px #00eaff; }

  #announcement { width:100%; text-align:center; font-size:1em; height:2em; overflow:hidden; white-space:nowrap; margin-top:5px; }
  .scroll-text { display:inline-block; }

  #main-container { display:flex; flex:1; overflow:hidden; }
  #map { flex:1; position:relative; display:flex; justify-content:center; align-items:center; overflow:hidden; }
  #status-panel { width:280px; background:rgba(30,30,30,0.8); border-left:1px solid #555; padding:10px; overflow-y:auto; }

  .base { position:absolute; width:55px; height:55px; border-radius:50%; background:rgba(90,200,255,0.2); border:2px solid #8ae1ff; display:flex; justify-content:center; align-items:center; font-size:0.8em; color:#8ae1ff; transition:all .5s ease; }
  .hp-bar { width:40px; height:4px; background:#222; border:1px solid #444; position:absolute; bottom:-8px; left:7px; border-radius:2px; }
  .hp-fill { height:100%; border-radius:2px; }

</style>
</head>
<body>
<header>
  <h1>é˜²è¡›æˆ¦æ³ãƒ¢ãƒ‹ã‚¿</h1>
  <nav>
    <a href="../index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a>
    <a href="../craft.html">âš’ï¸ ã‚¯ãƒ©ãƒ•ãƒˆ</a>
    <a href="../items.html">ğŸ’ ã‚¢ã‚¤ãƒ†ãƒ </a>
  </nav>
</header>

<div id="announcement"><span id="announcementText" class="scroll-text"></span></div>

<div id="main-container">
  <div id="map"></div>
  <div id="status-panel"></div>
</div>

<script>
const map = document.getElementById("map");
const statusPanel = document.getElementById("status-panel");
const announcementText = document.getElementById("announcementText");

const bases = [];
const numBases = 20;
const radius = 250;

// === æ‹ ç‚¹åˆæœŸç”Ÿæˆ ===
for(let i=0;i<numBases;i++){
  const base = document.createElement("div");
  base.classList.add("base");
  base.dataset.id = i===0?"æœ¬éƒ¨":`æ‹ ç‚¹${i}`;
  base.dataset.hp = 100;
  base.dataset.resource = (Math.random()*4000+1000).toFixed(0);
  base.dataset.enemies = Math.floor(Math.random()*300);
  base.textContent = base.dataset.id;

  const hpBar = document.createElement("div");
  hpBar.classList.add("hp-bar");
  const hpFill = document.createElement("div");
  hpFill.classList.add("hp-fill");
  hpBar.appendChild(hpFill);
  base.appendChild(hpBar);
  map.appendChild(base);
  bases.push(base);
}

// === æ‹ ç‚¹å††é™£é…ç½® ===
function positionBases(){
  const centerX = map.offsetWidth/2;
  const centerY = map.offsetHeight/2+280;
  bases.forEach((base,i)=>{
    if(i===0){ base.style.left=`${centerX-27}px`; base.style.top=`${centerY-27}px`; return; }
    const angle = (i/19)*2*Math.PI;
    const distortX = Math.sin(angle*3)*20;
    const distortY = Math.cos(angle*5)*20;
    base.style.left=`${centerX+radius*Math.cos(angle)+distortX-27}px`;
    base.style.top=`${centerY+radius*Math.sin(angle)+distortY-27}px`;
  });
}
positionBases();
window.addEventListener("resize",positionBases);

// === çŠ¶æ…‹æ›´æ–° ===
function updateBases(){
  bases.forEach(base=>{
    if(base.dataset.id==="æœ¬éƒ¨") return;
    let hp = Math.max(0, base.dataset.hp - Math.random()*5);
    base.dataset.hp = hp.toFixed(0);
    base.dataset.enemies = Math.max(0, base.dataset.enemies - Math.random()*5).toFixed(0);
    base.dataset.resource = (parseInt(base.dataset.resource)+Math.random()*30-15).toFixed(0);

    const hpFill = base.querySelector(".hp-fill");
    hpFill.style.width=`${hp}%`;
    if(base.dataset.enemies==0){ hpFill.style.background="#00ff7f"; }
    else if(hp>60){ hpFill.style.background="#00ff9d"; }
    else if(hp>30){ hpFill.style.background="#ffeb3b"; }
    else{ hpFill.style.background="#ff4b4b"; }
  });
  updateStatusPanel();
}

// === ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‘ãƒãƒ«æ›´æ–° ===
function updateStatusPanel(){
  statusPanel.innerHTML="<h3>æ‹ ç‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>";
  bases.forEach(base=>{
    const entry=document.createElement("div");
    entry.classList.add("status-entry");
    entry.innerHTML=`
      <strong>${base.dataset.id}</strong><br>
      ğŸ’šHP: ${base.dataset.hp}%ã€€
      ğŸª¨è³‡æº: ${base.dataset.resource}ã€€
      ğŸ‘¾æ•µæ•°: ${base.dataset.enemies}
    `;
    statusPanel.appendChild(entry);
  });
}

// === ã‚¢ãƒŠã‚¦ãƒ³ã‚¹æ›´æ–°ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ»æ‹ ç‚¹ã”ã¨ï¼‰ ===
let annIndex=0;
function updateAnnouncement(){
  const aliveBases = bases.filter(b=>b.dataset.id!=="æœ¬éƒ¨");
  if(aliveBases.length===0){ announcementText.textContent="å…¨æ‹ ç‚¹ã€é˜²è¡›å®Œäº†ï¼"; announcementText.style.color="#00ff7f"; return; }

  const b = aliveBases[annIndex%aliveBases.length];
  if(b.dataset.enemies==0){ announcementText.style.color="#00ff7f"; announcementText.textContent=`${b.dataset.id} é˜²è¡›å®Œäº†ï¼`; }
  else if(b.dataset.hp>50){ announcementText.style.color="#7fe8ff"; announcementText.textContent=`${b.dataset.id} é˜²è¡›ä¸­`; }
  else{ announcementText.style.color="#ff4b4b"; announcementText.textContent=`${b.dataset.id} ç·Šæ€¥ï¼æ•‘æ´è¦è«‹ï¼`; }

  annIndex++;
}
updateBases();
updateStatusPanel();
updateAnnouncement();
setInterval(updateBases,5000);
setInterval(updateAnnouncement,3600*1000); // 1æ™‚é–“ã”ã¨
</script>
</body>
</html>
