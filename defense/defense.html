<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é˜²è¡›æˆ¦æ³ - æ‹ ç‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</title>
<style>
body {
  margin:0;
  font-family:"Consolas","Roboto Mono",monospace;
  background:#000;
  color:#e0e0e0;
  display:flex;
  flex-direction:column;
}
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 20px;
  background:#111;
  border-bottom:1px solid #444;
}
header h1 { font-size:1.2em; color:#8ae1ff; }
nav a { color:#8ae1ff; margin-left:12px; text-decoration:none; transition:0.3s; }
nav a:hover { color:#fff; text-shadow:0 0 5px #00eaff; }

#announcement {
  width:100%;
  text-align:center;
  font-size:1em;
  white-space:nowrap;
  overflow:hidden;
  height:2em;
  margin-top:5px;
  color:#7fe8ff;
}
.scroll-text { display:inline-block; }

#main-container { display:flex; flex:1; }
#map {
  position:relative;
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
}
#status-panel {
  width:280px;
  background:#111;
  border-left:1px solid #555;
  padding:10px;
  overflow-y:auto;
  max-height:100%;
}
.status-entry { border-bottom:1px solid #333; padding:6px 0; font-size:0.85em; }

.base {
  position:absolute;
  width:55px; height:55px;
  border-radius:50%;
  background:rgba(90,200,255,0.2);
  border:2px solid #8ae1ff;
  display:flex; justify-content:center; align-items:center;
  font-size:0.8em;
  color:#8ae1ff;
  cursor:pointer;
  transition:all 0.5s ease;
}
.hp-bar {
  width:40px; height:4px;
  background:#222;
  border:1px solid #444;
  position:absolute;
  bottom:-8px;
  left:7px;
  border-radius:2px;
}
.hp-fill { height:100%; border-radius:2px; background:#00ff9d; }

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal-bg {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
  z-index:100;
}
.modal-content {
  background:#222;
  padding:20px;
  border:2px solid #8ae1ff;
  border-radius:8px;
  text-align:center;
  max-height:80%;
  overflow-y:auto;
}
.modal-content button {
  margin:5px;
  padding:8px 12px;
  background:#111;
  border:1px solid #8ae1ff;
  color:#8ae1ff;
  cursor:pointer;
}
.modal-content button:hover {
  background:#8ae1ff; color:#000;
}
</style>
</head>
<body>
<header>
  <h1>é˜²è¡›æˆ¦æ³ãƒ¢ãƒ‹ã‚¿</h1>
  <nav>
    <a href="../index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a>
    <a href="../craft.html">âš’ï¸ ã‚¯ãƒ©ãƒ•ãƒˆ</a>
    <a href="../items.html">ğŸ’ ã‚¢ã‚¤ãƒ†ãƒ </a>
    <a href="#" id="myStatsLink">ğŸ“Š è‡ªåˆ†ã®æˆ¦ç¸¾</a>
  </nav>
</header>

<div id="announcement"><span id="announcementText" class="scroll-text"></span></div>

<div id="main-container">
  <div id="map"></div>
  <div id="status-panel"></div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-bg" id="modalBg">
  <div class="modal-content" id="modalContent">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <div>
      <button id="combatBtn">âš” æˆ¦é—˜</button>
      <button id="exploreBtn">ğŸ§­ æ¢ç´¢</button>
      <button id="rescueBtn">ğŸ©¹ æ•‘åŠ©</button>
      <button id="viewStatsBtn">ğŸ“Š æˆ¦ç¸¾</button>
    </div>
    <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<script>
const map = document.getElementById("map");
const statusPanel = document.getElementById("status-panel");
const announcementText = document.getElementById("announcementText");
const modalBg = document.getElementById("modalBg");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");
const myStatsLink = document.getElementById("myStatsLink");

const bases = [];
const numBases = 20;
const radius = 250;

// ãƒ€ãƒŸãƒ¼ã®æˆ¦ç¸¾ãƒ‡ãƒ¼ã‚¿
function generateDummyStats(baseId){
  const stats = [];
  for(let i=0;i<5;i++){
    stats.push({
      name: `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}`,
      kills: Math.floor(Math.random()*50),
      rescues: Math.floor(Math.random()*10),
      explored: Math.floor(Math.random()*5)
    });
  }
  return stats;
}

// æ‹ ç‚¹ç”Ÿæˆ
for(let i=0;i<numBases;i++){
  const base=document.createElement("div");
  base.classList.add("base");
  base.dataset.id=i===0?"æœ¬éƒ¨":`æ‹ ç‚¹${i}`;
  base.dataset.hp=100;
  base.dataset.resource=(Math.random()*4000+1000).toFixed(0);
  base.dataset.enemies=Math.floor(Math.random()*300);
  base.textContent=base.dataset.id;

  const hpBar=document.createElement("div");
  hpBar.classList.add("hp-bar");
  const hpFill=document.createElement("div");
  hpFill.classList.add("hp-fill");
  hpBar.appendChild(hpFill);
  base.appendChild(hpBar);
  map.appendChild(base);
  bases.push(base);

  // ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  base.addEventListener("click", ()=>{
    modalBg.style.display="flex";
    modalTitle.textContent = base.dataset.id;
    modalBody.innerHTML = "";
  });

  // ãƒœã‚¿ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  document.getElementById("combatBtn").onclick = ()=>alert("æˆ¦é—˜ã¸ç§»å‹•");
  document.getElementById("exploreBtn").onclick = ()=>alert("æ¢ç´¢ã¸ç§»å‹•");
  document.getElementById("rescueBtn").onclick = ()=>alert("æ•‘åŠ©ã¸ç§»å‹•");
  document.getElementById("viewStatsBtn").onclick = ()=>{
    modalBody.innerHTML = "<h4>æ‹ ç‚¹å…¨å“¡ã®æˆ¦ç¸¾</h4>";
    const stats = generateDummyStats(base.dataset.id);
    stats.forEach(s=>{
      modalBody.innerHTML += `åå‰: ${s.name}ã€€âš”${s.kills}ã€€ğŸ©¹${s.rescues}ã€€ğŸ§­${s.explored}<br>`;
    });
  };
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
function closeModal(){ modalBg.style.display="none"; }
modalBg.addEventListener("click",(e)=>{ if(e.target===modalBg) closeModal(); });

// å††é™£é…ç½®
function positionBases(){
  const centerX=map.offsetWidth/2;
  const centerY=map.offsetHeight/2 + 250;
  bases.forEach((base,i)=>{
    if(i===0){ base.style.left=`${centerX-27.5}px`; base.style.top=`${centerY-27.5}px`; return; }
    const angle=(i/19)*2*Math.PI;
    const distortX=Math.sin(angle*3)*20;
    const distortY=Math.cos(angle*5)*20;
    base.style.left=`${centerX + radius*Math.cos(angle)+distortX-27.5}px`;
    base.style.top=`${centerY + radius*Math.sin(angle)+distortY-27.5}px`;
  });
}
positionBases();
window.addEventListener("resize",positionBases);

// çŠ¶æ…‹æ›´æ–°
function updateBases(){
  bases.forEach(base=>{
    if(base.dataset.id==="æœ¬éƒ¨") return;
    const hp=Math.max(0, base.dataset.hp - Math.random()*5);
    base.dataset.hp=hp.toFixed(0);
    base.dataset.enemies=Math.max(0, base.dataset.enemies - Math.random()*5).toFixed(0);
    base.dataset.resource=(parseInt(base.dataset.resource)+Math.random()*30-15).toFixed(0);

    const hpFill=base.querySelector(".hp-fill");
    hpFill.style.width=`${hp}%`;
    if(hp>60) hpFill.style.background="#00ff9d";
    else if(hp>30) hpFill.style.background="#ffeb3b";
    else hpFill.style.background="#ff4b4b";
  });
  updateStatusPanel();
}

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§
function updateStatusPanel(){
  statusPanel.innerHTML="<h3>æ‹ ç‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>";
  bases.forEach(base=>{
    const entry=document.createElement("div");
    entry.classList.add("status-entry");
    entry.innerHTML=`<strong>${base.dataset.id}</strong><br>
      ğŸ’šHP: ${base.dataset.hp}%ã€€ğŸª¨è³‡æº: ${base.dataset.resource}ã€€ğŸ‘¾æ•µæ•°: ${base.dataset.enemies}`;
    statusPanel.appendChild(entry);
  });
}

// æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒŠã‚¦ãƒ³ã‚¹
let annIndex=0,scrolling=false;
function scrollAnnouncement(){
  if(scrolling) return;
  scrolling=true;
  const aliveBases=bases.filter(b=>b.dataset.id!=="æœ¬éƒ¨");
  if(aliveBases.length===0){
    announcementText.style.color="#00ff7f";
    announcementText.textContent="å…¨æ‹ ç‚¹ã€é˜²è¡›å®Œäº†ï¼";
    scrolling=false;
    return;
  }
  const b=aliveBases[annIndex%aliveBases.length];
  if(b.dataset.enemies==0){ announcementText.style.color="#00ff7f"; announcementText.textContent=`${b.dataset.id} æ•µã®æ’¤é€€ã‚’ç¢ºèªã€é˜²è¡›å®Œäº†ï¼`; }
  else if(b.dataset.hp>50){ announcementText.style.color="#7fe8ff"; announcementText.textContent=`${b.dataset.id} é˜²è¡›ä¸­ã€æˆ¦ç·šå®‰å®š`; }
  else{ announcementText.style.color="#ff4b4b"; announcementText.textContent=`${b.dataset.id} ç·Šæ€¥ï¼æ•‘æ´è¦è«‹ï¼`; }

  announcementText.style.transition="none";
  announcementText.style.transform="translateX(100%)";

  requestAnimationFrame(()=>{
    announcementText.style.transition="transform 8s linear";
    announcementText.style.transform="translateX(-100%)";
    setTimeout(()=>{
      announcementText.style.transition="none";
      announcementText.style.transform="translateX(0%)";
      setTimeout(()=>{
        annIndex++;
        scrolling=false;
        scrollAnnouncement();
      },3000);
    },8000);
  });
}

// è‡ªåˆ†ã®æˆ¦ç¸¾ãƒªãƒ³ã‚¯
myStatsLink.addEventListener("click",()=>{
  modalBg.style.display="flex";
  modalTitle.textContent="è‡ªåˆ†ã®æˆ¦ç¸¾";
  modalBody.innerHTML="<h4>è‡ªåˆ†ã®æˆ¦ç¸¾</h4>";
  const myStats = generateDummyStats("è‡ªåˆ†");
  modalBody.innerHTML += `åå‰: ã‚ãªãŸã€€âš”${myStats[0].kills}ã€€ğŸ©¹${myStats[0].rescues}ã€€ğŸ§­${myStats[0].explored}`;
});

// åˆæœŸå‘¼ã³å‡ºã—
updateStatusPanel();
updateBases();
scrollAnnouncement();
setInterval(updateBases,5000);
</script>
</body>
</html>
