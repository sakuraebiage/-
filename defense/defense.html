<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Èò≤Ë°õÊà¶Ê≥Å - Êã†ÁÇπ„É¢„Éã„Çø„É™„É≥„Ç∞</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      margin: 0;
      font-family: "Consolas", "Roboto Mono", monospace;
      background: radial-gradient(circle at 50% 60%, #1a1a1a 0%, #000 100%);
      color: #e0e0e0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: rgba(30, 30, 30, 0.85);
      border-bottom: 1px solid #444;
    }

    header h1 {
      font-size: 1.2em;
      color: #8ae1ff;
    }

    nav a {
      color: #8ae1ff;
      margin-left: 12px;
      text-decoration: none;
      transition: 0.3s;
    }

    nav a:hover {
      color: #fff;
      text-shadow: 0 0 5px #00eaff;
    }

    #announcement {
      width: 100%;
      text-align: center;
      font-size: 1em;
      color: #7fe8ff;
      white-space: nowrap;
      overflow: hidden;
      height: 2em;
      margin-top: 5px;
    }

    .scroll-text {
      display: inline-block;
      animation: scroll-left 20s linear infinite;
    }

    @keyframes scroll-left {
      0% { transform: translateX(100%); }
      50% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    #main-container {
      display: flex;
      flex: 1;
    }

    #map {
      position: relative;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #status-panel {
      width: 280px;
      background: rgba(30, 30, 30, 0.8);
      border-left: 1px solid #555;
      padding: 10px;
      overflow-y: auto;
    }

    .status-entry {
      border-bottom: 1px solid #333;
      padding: 6px 0;
      font-size: 0.85em;
    }

    .base {
      position: absolute;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: rgba(90, 200, 255, 0.2);
      border: 2px solid #8ae1ff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.8em;
      color: #8ae1ff;
      transition: all 0.5s ease;
    }

    .hp-bar {
      width: 40px;
      height: 4px;
      background: #222;
      border: 1px solid #444;
      position: absolute;
      bottom: -8px;
      left: 7px;
      border-radius: 2px;
    }

    .hp-fill {
      height: 100%;
      background: #00ff9d;
      border-radius: 2px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Èò≤Ë°õÊà¶Ê≥Å„É¢„Éã„Çø</h1>
    <nav>
      <a href="../index.html">üè† „Éõ„Éº„É†</a>
      <a href="../craft.html">‚öíÔ∏è „ÇØ„É©„Éï„Éà</a>
      <a href="../items.html">üéí „Ç¢„Ç§„ÉÜ„É†</a>
    </nav>
  </header>

  <div id="announcement"><span id="announcementText" class="scroll-text"></span></div>

  <div id="main-container">
    <div id="map"></div>
    <div id="status-panel"></div>
  </div>

  <script>
    const map = document.getElementById("map");
    const statusPanel = document.getElementById("status-panel");
    const announcementText = document.getElementById("announcementText");

    const bases = [];
    const numBases = 20;
    const radius = 250;

    // === ÂàùÊúüÁîüÊàê ===
    for (let i = 0; i < numBases; i++) {
      const base = document.createElement("div");
      base.classList.add("base");
      base.dataset.id = i === 0 ? "Êú¨ÈÉ®" : `Êã†ÁÇπ${i}`;
      base.dataset.hp = 100;
      base.dataset.resource = (Math.random() * 4000 + 1000).toFixed(0); // Ë≥áÊ∫ê
      base.dataset.enemies = Math.floor(Math.random() * 300); // ÊïµÊï∞
      base.textContent = base.dataset.id;

      const hpBar = document.createElement("div");
      hpBar.classList.add("hp-bar");
      const hpFill = document.createElement("div");
      hpFill.classList.add("hp-fill");
      hpBar.appendChild(hpFill);
      base.appendChild(hpBar);
      map.appendChild(base);
      bases.push(base);
    }

    // === Êã†ÁÇπ„ÅÆÈÖçÁΩÆ ===
    function positionBases() {
      const centerX = map.offsetWidth / 2;
      const centerY = map.offsetHeight / 2 + 50;
      bases.forEach((base, i) => {
        if (i === 0) {
          base.style.left = `${centerX - 25}px`;
          base.style.top = `${centerY - 25}px`;
          return;
        }
        const angle = (i / 19) * 2 * Math.PI;
        const distortX = Math.sin(angle * 3) * 20;
        const distortY = Math.cos(angle * 5) * 20;
        base.style.left = `${centerX + radius * Math.cos(angle) + distortX}px`;
        base.style.top = `${centerY + radius * Math.sin(angle) + distortY}px`;
      });
    }

    positionBases();
    window.addEventListener("resize", positionBases);

    // === Áä∂ÊÖãÊõ¥Êñ∞ ===
    function updateBases() {
      bases.forEach(base => {
        if (base.dataset.id === "Êú¨ÈÉ®") return;
        // HP‰Ωé‰∏ã
        const hp = Math.max(0, base.dataset.hp - Math.random() * 5);
        base.dataset.hp = hp.toFixed(0);
        // ÊïµÊï∞„ÅØÊôÇÈñì„ÅßÊ∏õÂ∞ë„ÄÅË≥áÊ∫ê„ÅØÂ§âÂãï
        base.dataset.enemies = Math.max(0, base.dataset.enemies - Math.random() * 5).toFixed(0);
        base.dataset.resource = (parseInt(base.dataset.resource) + Math.random() * 30 - 15).toFixed(0);

        const hpFill = base.querySelector(".hp-fill");
        hpFill.style.width = `${hp}%`;
        if (hp > 60) hpFill.style.background = "#00ff9d";
        else if (hp > 30) hpFill.style.background = "#ffeb3b";
        else hpFill.style.background = "#ff4b4b";
      });
      updateStatusPanel();
    }

    // === „Çπ„ÉÜ„Éº„Çø„Çπ‰∏ÄË¶ß ===
    function updateStatusPanel() {
      statusPanel.innerHTML = "<h3>Êã†ÁÇπ„Çπ„ÉÜ„Éº„Çø„Çπ</h3>";
      bases.forEach(base => {
        const entry = document.createElement("div");
        entry.classList.add("status-entry");
        entry.innerHTML = `
          <strong>${base.dataset.id}</strong><br>
          üíöHP: ${base.dataset.hp}%„ÄÄ
          ü™®Ë≥áÊ∫ê: ${base.dataset.resource}„ÄÄ
          üëæÊïµÊï∞: ${base.dataset.enemies}
        `;
        statusPanel.appendChild(entry);
      });
    }

    // === „Ç¢„Éä„Ç¶„É≥„Çπ ===
    function updateAnnouncement() {
      const critical = bases.filter(b => b.dataset.hp < 50 && b.dataset.id !== "Êú¨ÈÉ®");
      if (critical.length === 0) {
        announcementText.textContent = "ÂÖ®Êã†ÁÇπ„ÄÅÈò≤Ë°õÂÆå‰∫Ü„ÄÇÊà¶Á∑ö„ÅØÂÆâÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ";
      } else {
        const b = critical[Math.floor(Math.random() * critical.length)];
        announcementText.textContent = `${b.dataset.id}„ÅÆÈò≤Ë°õ„É©„Ç§„É≥„ÅåÊêçËÄó‰∏≠ÔºÅÊïëÊè¥„ÇíË¶ÅË´ãÔºÅ`;
      }
    }

    // === ÂÆöÊúüÊõ¥Êñ∞ ===
    updateStatusPanel();
    updateAnnouncement();
    setInterval(updateBases, 5000);
    setInterval(updateAnnouncement, 3600000);
  </script>
</body>
</html>
