<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>防衛戦マップ</title>
<style>
body { font-family: sans-serif; margin: 0; padding: 0; }
h1 { margin: 10px; }
a { margin-left: 10px; }
#container { display: flex; height: 70vh; }
#map { flex: 3; position: relative; background: #e0f7fa; }
#statusPanel { flex: 1; padding: 10px; background: #fafafa; border-left: 1px solid #ccc; overflow-y: auto; }
.base { width: 40px; height: 40px; border-radius: 50%; position: absolute; text-align: center; line-height: 40px; color: #fff; font-weight: bold; }
.official { background: #ff5722; }
.user { background: #4caf50; }
.face { width: 20px; height: 20px; border-radius: 50%; display: inline-block; background: #ffeb3b; margin-right: 2px; vertical-align: middle; }
#announcements { height: 30px; background: #fafafa; overflow: hidden; white-space: nowrap; border-top: 1px solid #ccc; position: relative; }
.progressBar { width: 100%; }
.marquee { display: inline-block; padding-left: 100%; animation: scrollLeft 20s linear infinite; }
@keyframes scrollLeft { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }
</style>
</head>
<body>

<h1>防衛戦マップ <a href="../index.html">トップに戻る</a></h1>

<div id="container">
  <div id="map"></div>
  <div id="statusPanel">
    <h3>拠点状況</h3>
    <div id="baseStatus"></div>
  </div>
</div>

<div id="announcements"><div class="marquee" id="marqueeContent"></div></div>

<script>
const map = document.getElementById('map');
const baseStatusDiv = document.getElementById('baseStatus');
const marqueeContent = document.getElementById('marqueeContent');

// 円陣拠点データ
const centerX = 400, centerY = 300, radius = 150;
const numBases = 20;
const bases = [];

for(let i=0;i<numBases;i++){
  const angle = 2*Math.PI/numBases*i;
  const x = centerX + radius * Math.cos(angle);
  const y = centerY + radius * Math.sin(angle);
  bases.push({
    id:'b'+i, x, y, type:'user', name:'拠点'+(i+1),
    faces:['A'+i], hp:100, resource:0, enemy:10
  });
}

// マップに配置
bases.forEach(b => {
  const div = document.createElement('div');
  div.className = 'base ' + b.type;
  div.style.left = (b.x-20)+'px';
  div.style.top = (b.y-20)+'px';
  div.innerHTML = b.name[0];
  b.faces.forEach(f=>{
    const fdiv = document.createElement('span');
    fdiv.className='face';
    fdiv.title=f;
    div.appendChild(fdiv);
  });
  map.appendChild(div);
});

// 拠点ステータス描画（ゲージ付き）
function renderStatus(){
  baseStatusDiv.innerHTML='';
  bases.forEach(b=>{
    const div = document.createElement('div');
    div.style.marginBottom='10px';
    div.innerHTML = `<strong>${b.name}</strong><br>
      HP: <progress class="progressBar" value="${b.hp}" max="100"></progress> ${b.hp}%<br>
      リソース: <progress class="progressBar" value="${b.resource}" max="50"></progress> ${b.resource}<br>
      残敵: <progress class="progressBar" value="${b.enemy}" max="10"></progress> ${b.enemy}`;
    baseStatusDiv.appendChild(div);
  });
}

// 戦況アナウンス（横スクロール）
function updateLogs(){
  let logText = '';
  bases.forEach(b=>{
    if(b.hp<30){
      logText += `%c${b.name}が危険！HP:${b.hp}% 残敵:${b.enemy}    `;
    } else if(b.enemy>7){
      logText += `%c${b.name}に敵接近！残敵:${b.enemy}    `;
    } else {
      logText += `%c${b.name}は安定。HP:${b.hp}% 残敵:${b.enemy}    `;
    }
  });
  marqueeContent.innerHTML='';
  bases.forEach(b=>{
    const span = document.createElement('span');
    if(b.hp<30) span.style.color='red';
    else if(b.enemy>7) span.style.color='orange';
    else span.style.color='black';
    span.textContent = `${b.name}:HP${b.hp}% R:${b.resource} E:${b.enemy}  `;
    marqueeContent.appendChild(span);
  });
}

// テスト用：5秒ごとにHPランダム減少・リソース増加・敵変化
setInterval(()=>{
  bases.forEach(b=>{
    b.hp = Math.max(0, b.hp - Math.floor(Math.random()*5));
    b.resource += Math.floor(Math.random()*3);
    b.enemy = Math.max(0, Math.min(10, b.enemy + Math.floor(Math.random()*3)-1));
  });
  renderStatus();
  updateLogs();
},5000);

// 初回描画
renderStatus();
updateLogs();

</script>

</body>
</html>
